# Herbal-Trace: Blockchain-Integrated Supply Chain Traceability System\n\n## üåø Enhanced Features Overview\n\nOur Herbal-Trace project has been significantly enhanced with blockchain integration, advanced security features, and comprehensive OTP-based authentication. This document outlines all the new features and improvements implemented to meet your requirements.\n\n## üîê Enhanced Security Features\n\n### Multi-Factor Authentication\n- **Email OTP Verification**: Secure login using email-based one-time passwords\n- **Mobile OTP Verification**: SMS-based authentication for enhanced security\n- **Traditional Login**: Username/password with enhanced security measures\n- **Registration with Email Verification**: New users must verify their email addresses\n\n### Security Middleware Stack\n- **SQL Injection Protection**: Input sanitization and parameterized queries\n- **XSS Prevention**: Content Security Policy and input/output encoding\n- **CSRF Protection**: Cross-site request forgery prevention\n- **Rate Limiting**: API endpoint protection against brute force attacks\n- **Helmet.js Integration**: Security headers and HTTP security best practices\n- **Session Security**: Secure session management with Redis\n- **Audit Logging**: Comprehensive security event tracking\n\n### Input Validation & Sanitization\n- **Express Validator**: Server-side input validation\n- **HTML Sanitization**: Prevention of malicious HTML injection\n- **File Upload Security**: Secure file handling with type validation\n- **Password Security**: bcrypt hashing with salt rounds\n\n## üîó Blockchain Integration\n\n### Hyperledger Fabric Network\n- **Distributed Ledger**: Immutable supply chain records\n- **Smart Contracts**: Automated business logic execution\n- **Peer Network**: Decentralized validation and consensus\n- **Channel Architecture**: Privacy-focused data segregation\n\n### Blockchain Services\n- **Collection Events**: Record herbal collection on blockchain\n- **Quality Tests**: Immutable quality assessment records\n- **Processing Steps**: Track processing and manufacturing stages\n- **Provenance Generation**: Complete supply chain history\n- **Network Monitoring**: Real-time blockchain health status\n\n### Smart Contract Operations\n```javascript\n// Example blockchain operations\nconst collection = await BlockchainService.createCollectionEvent({\n  farmerId: 'farmer_001',\n  species: 'Curcuma longa',\n  quantity: '100kg',\n  location: 'Kerala, India',\n  timestamp: new Date().toISOString()\n});\n\nconst provenance = await BlockchainService.getProvenance('product_001');\n```\n\n## üèóÔ∏è System Architecture\n\n### Backend Infrastructure\n```\n/backend/\n‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îú‚îÄ‚îÄ server.js                 # Main server with security middleware\n‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.js            # Environment configuration\n‚îÇ   ‚îú‚îÄ‚îÄ services/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FabricNetworkService.js   # Blockchain integration\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthService.js           # Enhanced authentication\n‚îÇ   ‚îú‚îÄ‚îÄ middleware/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ securityMiddleware.js    # Security protections\n‚îÇ   ‚îú‚îÄ‚îÄ routes/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js              # Authentication endpoints\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blockchain.js        # Blockchain operations\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js               # General API routes\n‚îÇ   ‚îî‚îÄ‚îÄ utils/\n‚îÇ       ‚îî‚îÄ‚îÄ logger.js            # Security audit logging\n‚îú‚îÄ‚îÄ package.json                 # Dependencies\n‚îî‚îÄ‚îÄ README.md                   # Backend documentation\n```\n\n### Frontend Components\n```\n/src/\n‚îú‚îÄ‚îÄ components/\n‚îÇ   ‚îú‚îÄ‚îÄ EnhancedLogin.js         # Multi-tab authentication UI\n‚îÇ   ‚îú‚îÄ‚îÄ BlockchainDashboard.js   # Role-based blockchain dashboard\n‚îÇ   ‚îî‚îÄ‚îÄ BlockchainQRScanner.js   # Blockchain verification scanner\n‚îú‚îÄ‚îÄ services/\n‚îÇ   ‚îú‚îÄ‚îÄ BlockchainService.js     # Blockchain API integration\n‚îÇ   ‚îî‚îÄ‚îÄ EnhancedAuthService.js   # Enhanced authentication service\n‚îî‚îÄ‚îÄ utils/\n    ‚îî‚îÄ‚îÄ securityUtils.js         # Frontend security utilities\n```\n\n## üöÄ Getting Started\n\n### Prerequisites\n```bash\n# Required software\nNode.js >= 18.x\nRedis >= 6.x\nPostgreSQL >= 13.x\nHyperledger Fabric 2.5.x\nDocker & Docker Compose\n```\n\n### Backend Setup\n```bash\n# Navigate to backend directory\ncd backend\n\n# Install dependencies\nnpm install\n\n# Set up environment variables\ncp .env.example .env\n# Edit .env with your configuration\n\n# Start services\ndocker-compose up -d  # Redis, PostgreSQL, Fabric network\n\n# Start the server\nnpm run dev\n```\n\n### Frontend Setup\n```bash\n# Navigate to project root\ncd Herbal-Trace\n\n# Install dependencies\nnpm install\n\n# Start the development server\nnpm start\n```\n\n### Environment Configuration\n```env\n# Backend .env file\nPORT=5000\nNODE_ENV=development\n\n# Database\nPOSTGRES_HOST=localhost\nPOSTGRES_PORT=5432\nPOSTGRES_DB=herbal_trace\nPOSTGRES_USER=your_username\nPOSTGRES_PASSWORD=your_password\n\n# Redis\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_PASSWORD=your_redis_password\n\n# JWT\nJWT_SECRET=your_jwt_secret_key\nJWT_REFRESH_SECRET=your_refresh_secret_key\n\n# Email (Nodemailer)\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=587\nEMAIL_USER=your_email@gmail.com\nEMAIL_PASS=your_app_password\n\n# SMS (Twilio)\nTWILIO_ACCOUNT_SID=your_twilio_sid\nTWILIO_AUTH_TOKEN=your_twilio_token\nTWILIO_PHONE_NUMBER=your_twilio_phone\n\n# Hyperledger Fabric\nFABRIC_NETWORK_PATH=./fabric-network\nFABRIC_CHANNEL_NAME=herbaltrace-channel\nFABRIC_CHAINCODE_NAME=herbal-trace-cc\n```\n\n## üîë Authentication Flow\n\n### Enhanced Login Process\n1. **User Access**: Navigate to `/enhanced-login`\n2. **Authentication Method Selection**:\n   - Traditional login (username/password)\n   - Email OTP login\n   - Mobile OTP login\n   - New user registration\n3. **OTP Verification**: \n   - Email: 6-digit code sent via Nodemailer\n   - SMS: 6-digit code sent via Twilio\n4. **JWT Token Generation**: Secure tokens with refresh capability\n5. **Session Management**: Redis-based session storage\n\n### Security Measures\n- **Rate Limiting**: 5 attempts per 15 minutes per IP\n- **Account Lockout**: Temporary lockout after failed attempts\n- **Password Policy**: Minimum complexity requirements\n- **Token Security**: Short-lived access tokens with refresh mechanism\n\n## üè≠ Blockchain Operations\n\n### Supply Chain Events\n\n#### 1. Collection Event\n```javascript\nconst collectionEvent = {\n  eventType: 'COLLECTION',\n  farmerId: 'farmer_001',\n  species: 'Curcuma longa',\n  quantity: 100,\n  unit: 'kg',\n  location: {\n    coordinates: [76.2711, 10.8505],\n    address: 'Kochi, Kerala'\n  },\n  qualityMetrics: {\n    moisture: 8.2,\n    purity: 98.5,\n    activeCompounds: {\n      curcumin: '3.2%'\n    }\n  },\n  timestamp: new Date().toISOString()\n};\n```\n\n#### 2. Quality Test\n```javascript\nconst qualityTest = {\n  eventType: 'QUALITY_TEST',\n  testId: 'QT_001',\n  laboratoryId: 'lab_001',\n  productId: 'product_001',\n  testResults: {\n    pesticides: 'Not Detected',\n    heavyMetals: 'Within Limits',\n    microbiology: 'Passed',\n    activeCompounds: {\n      curcumin: '3.2%',\n      turmerone: '0.8%'\n    }\n  },\n  certification: 'ORGANIC_CERTIFIED',\n  timestamp: new Date().toISOString()\n};\n```\n\n#### 3. Processing Step\n```javascript\nconst processingStep = {\n  eventType: 'PROCESSING',\n  processorId: 'proc_001',\n  processType: 'DRYING',\n  inputBatch: 'batch_001',\n  outputBatch: 'batch_002',\n  processingConditions: {\n    temperature: '40-45¬∞C',\n    humidity: '15%',\n    duration: '48 hours'\n  },\n  yieldPercentage: 85,\n  timestamp: new Date().toISOString()\n};\n```\n\n### Provenance Tracking\n```javascript\n// Get complete supply chain history\nconst provenance = await BlockchainService.getProvenance('product_001');\n\nconsole.log(provenance);\n// Output:\n{\n  productId: 'product_001',\n  species: 'Curcuma longa',\n  origin: 'Kerala, India',\n  harvestDate: '2024-01-15',\n  supplyChain: [\n    {\n      eventType: 'COLLECTION',\n      timestamp: '2024-01-15T08:00:00Z',\n      participantName: 'Ravi Kumar',\n      location: 'Kochi, Kerala',\n      quality: 'Grade A'\n    },\n    {\n      eventType: 'QUALITY_TEST',\n      timestamp: '2024-01-16T10:00:00Z',\n      participantName: 'Kerala Testing Lab',\n      location: 'Ernakulam, Kerala',\n      quality: 'Certified Organic'\n    },\n    {\n      eventType: 'PROCESSING',\n      timestamp: '2024-01-18T14:00:00Z',\n      participantName: 'Spice Processing Unit',\n      location: 'Cochin, Kerala',\n      quality: 'Premium Grade'\n    }\n  ]\n}\n```\n\n## üì± User Interface Components\n\n### Blockchain Dashboard\n- **Role-based Views**: Different dashboards for farmers, processors, labs, manufacturers, and consumers\n- **Real-time Status**: Live blockchain network status and health monitoring\n- **Analytics**: Transaction counts, network uptime, active participants\n- **Quick Actions**: Role-specific quick access buttons\n\n### Enhanced QR Scanner\n- **Blockchain Verification**: Direct blockchain lookup for product authenticity\n- **Supply Chain Timeline**: Visual representation of product journey\n- **Quality Certificates**: Display of test results and certifications\n- **Image Upload**: Support for QR code image uploads\n\n### Authentication Interface\n- **Multi-tab Design**: Separate tabs for different login methods\n- **Stepper Registration**: Guided registration process with email verification\n- **Form Validation**: Real-time validation with clear error messages\n- **Responsive Design**: Mobile-optimized authentication flows\n\n## üîí Security Implementation Details\n\n### SQL Injection Prevention\n```javascript\n// Parameterized queries\nconst query = 'SELECT * FROM users WHERE email = $1 AND status = $2';\nconst values = [email, 'active'];\nconst result = await db.query(query, values);\n\n// Input sanitization\nconst sanitizedInput = validator.escape(userInput);\n```\n\n### XSS Prevention\n```javascript\n// Content Security Policy\napp.use(helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      scriptSrc: [\"'self'\", \"'unsafe-inline'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      imgSrc: [\"'self'\", \"data:\", \"https:\"]\n    }\n  }\n}));\n\n// Output encoding\nconst safeHtml = DOMPurify.sanitize(userContent);\n```\n\n### Rate Limiting\n```javascript\nconst rateLimit = require('express-rate-limit');\n\nconst loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // 5 attempts per window\n  message: 'Too many login attempts, please try again later',\n  standardHeaders: true,\n  legacyHeaders: false\n});\n```\n\n## üìä Monitoring & Logging\n\n### Security Audit Logging\n```javascript\n// Winston logger configuration\nconst winston = require('winston');\n\nconst securityLogger = winston.createLogger({\n  level: 'info',\n  format: winston.format.combine(\n    winston.format.timestamp(),\n    winston.format.json()\n  ),\n  transports: [\n    new winston.transports.File({ filename: 'security-audit.log' }),\n    new winston.transports.Console()\n  ]\n});\n\n// Security event logging\nsecurityLogger.info('Login attempt', {\n  userId: user.id,\n  ip: req.ip,\n  userAgent: req.get('User-Agent'),\n  success: true,\n  timestamp: new Date().toISOString()\n});\n```\n\n### Blockchain Network Monitoring\n```javascript\n// Network health monitoring\nconst networkStatus = await BlockchainService.getNetworkStatus();\n\nconsole.log(networkStatus);\n// Output:\n{\n  connected: true,\n  blockHeight: 1234,\n  peers: [\n    { name: 'peer0.org1', connected: true },\n    { name: 'peer0.org2', connected: true }\n  ],\n  channels: ['herbaltrace-channel'],\n  chaincode: [\n    { name: 'herbal-trace-cc', version: '1.0', status: 'running' }\n  ]\n}\n```\n\n## üß™ Testing\n\n### Security Testing\n```bash\n# Run security tests\nnpm run test:security\n\n# SQL injection tests\nnpm run test:sql-injection\n\n# XSS vulnerability tests\nnpm run test:xss\n\n# Authentication tests\nnpm run test:auth\n```\n\n### Blockchain Testing\n```bash\n# Test blockchain connectivity\nnpm run test:blockchain\n\n# Test smart contract operations\nnpm run test:chaincode\n\n# Integration tests\nnpm run test:integration\n```\n\n## üöÄ Deployment\n\n### Production Deployment\n```bash\n# Build frontend\nnpm run build\n\n# Deploy to production server\ndocker-compose -f docker-compose.prod.yml up -d\n\n# Set up SSL certificates\ncertbot --nginx -d yourdomain.com\n```\n\n### Environment-specific Configurations\n- **Development**: Local blockchain network, debug logging\n- **Staging**: Shared blockchain network, comprehensive logging\n- **Production**: Production blockchain network, security hardening\n\n## üìã API Documentation\n\n### Authentication Endpoints\n```\nPOST /api/auth/login-traditional    # Traditional login\nPOST /api/auth/login-email-otp     # Email OTP login\nPOST /api/auth/login-mobile-otp    # Mobile OTP login\nPOST /api/auth/verify-otp          # OTP verification\nPOST /api/auth/register            # User registration\nPOST /api/auth/refresh-token       # Token refresh\nPOST /api/auth/logout              # User logout\n```\n\n### Blockchain Endpoints\n```\nPOST /api/blockchain/collection     # Create collection event\nPOST /api/blockchain/quality-test   # Record quality test\nPOST /api/blockchain/processing     # Record processing step\nGET  /api/blockchain/provenance/:id # Get product provenance\nGET  /api/blockchain/status         # Network status\nGET  /api/blockchain/analytics      # Blockchain analytics\n```\n\n## ü§ù Contributing\n\n1. Fork the repository\n2. Create a feature branch: `git checkout -b feature/new-feature`\n3. Make changes and commit: `git commit -am 'Add new feature'`\n4. Push to branch: `git push origin feature/new-feature`\n5. Submit a pull request\n\n## üìÑ License\n\nThis project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.\n\n## üÜò Support\n\nFor support and questions:\n- Email: support@herbal-trace.com\n- Documentation: [docs.herbal-trace.com](https://docs.herbal-trace.com)\n- Issues: [GitHub Issues](https://github.com/your-org/herbal-trace/issues)\n\n---\n\n**Herbal-Trace** - *Securing Supply Chains with Blockchain Technology*\n\n*Built with ‚ù§Ô∏è for transparent and secure herbal supply chains*